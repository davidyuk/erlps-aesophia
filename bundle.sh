#!/bin/sh

PATH=~/.local/bin:$PATH purs bundle "output/*/*.js" -m Aeb.Aevm.Abi -m Aeb.Aevm.Data -m Aeb.Asm -m Aeb.Asm.Scan -m Aeb.Disassemble -m Aeb.Fate.Abi -m Aeb.Fate.Asm -m Aeb.Fate.Asm.Scan -m Aeb.Fate.Code -m Aeb.Fate.Data -m Aeb.Fate.Encoding -m Aeb.Fate.Generate.Ops -m Aeb.Fate.Maps -m Aeb.Fate.Opcodes -m Aeb.Fate.Ops -m Aeb.Fate.Pp -m Aeb.Heap -m Aeb.Memory -m Aeb.Opcodes -m Aeb.Primops -m Aefateasm -m Aeser.Api.Encoder -m Aeser.Chain.Objects -m Aeser.Contract.Code -m Aeserialization -m Aeser.Id -m Aeser.Rlp -m Aeso.Aci -m Aeso.Ast -m Aeso.Ast.Infer.Types -m Aeso.Ast.To.Fcode -m Aeso.Ast.To.Icode -m Aeso.Builtins -m Aeso.Code.Errors -m Aeso.Compiler -m Aeso.Errors -m Aeso.Fcode.To.Fate -m Aeso.Icode -m Aeso.Icode.To.Asm -m Aeso.Parse.Lib -m Aeso.Parser -m Aeso.Pretty -m Aeso.Scan -m Aeso.Scan.Lib -m Aeso.Stdlib -m Aeso.Syntax -m Aeso.Syntax.Utils -m Aeso.Utils -m Aeso.Vm.Decode -m Array -m Base58 -m Base64 -m Crypto -m Dict -m Digraph -m Digraph.Utils -m Eblake2 -m Enacl -m Epp -m Erlang.Binary -m Erlang.Builtins -m Erlang.Exception -m Erlang.Helpers -m Erlang.Invoke -m Erlang.Io -m Erlang.Ioserver -m Erlang.Type -m Erlang.Unicode -m Erlang.Utils -m Erl.Anno -m Erl.Internal -m Erl.Lint -m Erl.Parse -m Erl.Posix.Msg -m Erl.Pp -m Erl.Scan -m Ets -m File -m Filename -m Gb.Sets -m Gb.Trees -m Getopt -m Io.Lib -m Io.Lib.Format -m Io.Lib.Pretty -m Jsx -m Jsx.Config -m Jsx.Consult -m Jsx.Decoder -m Jsx.Encoder -m Jsx.Parser -m Jsx.To.Json -m Jsx.To.Term -m Jsx.Verify -m Lists -m Maps -m Math -m Orddict -m Ordsets -m Os -m Otp.Internal -m Prettypr -m Proplists -m Queue -m Rand -m Sets -m Sofs -m String -m Unicode -m Unicode.Util -m Unicode.Util.Compat -o dist/index.js
echo -e "\n\nmodule.exports = PS" >> dist/index.js
runhaskell gen_filesystem.hs aesophia/priv/stdlib > output/File/filemap.json
NODE_OPTIONS=--max-old-space-size=4096 rollup -c
